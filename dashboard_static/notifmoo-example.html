<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NotifMoo.js example</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 640px; margin: 2rem auto; padding: 0 1rem; }
    #log { background: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: 8px; height: 200px; overflow-y: auto; font-size: 12px; white-space: pre-wrap; }
    .status { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 6px; }
    .status.connected { background: #4ade80; }
    .status.disconnected { background: #f87171; }
  </style>
</head>
<body>
  <h1>NotifMoo.js</h1>
  <p><span class="status disconnected" id="status"></span> <span id="state">-</span> <span id="sid"></span></p>
  <p>Subscribe to channel: <input type="text" id="channel" value="my-channel" /> <button id="sub">Subscribe</button> <button id="unsub">Unsubscribe</button></p>
  <div id="log"></div>

  <!-- Ganti YOUR_API_KEY dengan API key dari dashboard (domain key). -->
  <script src="notifmoo.js?apikey=YOUR_API_KEY"></script>
  <script>
    var logEl = document.getElementById('log');
    var stateEl = document.getElementById('state');
    var sidEl = document.getElementById('sid');
    var statusEl = document.getElementById('status');

    function log(msg) {
      logEl.textContent += new Date().toISOString().slice(11, 19) + ' ' + msg + '\n';
      logEl.scrollTop = logEl.scrollHeight;
    }

    NotifMoo.onConnect(function () {
      statusEl.className = 'status connected';
      stateEl.textContent = NotifMoo.readyState;
      sidEl.textContent = 'Socket: ' + (NotifMoo.socketId || '-');
      log('Connected, socket_id: ' + NotifMoo.socketId);
    });

    if (NotifMoo.readyState === 'connected') {
      statusEl.className = 'status connected';
      sidEl.textContent = 'Socket: ' + NotifMoo.socketId;
    }

    NotifMoo.bind('*', function (p) {
      if (p.event !== 'connection_established' && p.event !== 'pusher_internal:subscription_succeeded')
        log('Event: ' + p.event + ' on ' + p.channel + ' -> ' + JSON.stringify(p.data));
    });

    NotifMoo.onError(function (err) {
      log('Error: ' + (err.message || err));
    });

    document.getElementById('sub').onclick = function () {
      var ch = document.getElementById('channel').value.trim();
      if (!ch) return;
      NotifMoo.subscribe(ch, {
        onMessage: function (p) {
          log('[' + ch + '] ' + p.event + ': ' + JSON.stringify(p.data));
        }
      });
      log('Subscribed to ' + ch);
    };

    document.getElementById('unsub').onclick = function () {
      var ch = document.getElementById('channel').value.trim();
      if (!ch) return;
      NotifMoo.unsubscribe(ch);
      log('Unsubscribed from ' + ch);
    };

    log('NotifMoo loaded. apikey: ' + (NotifMoo.apikey ? 'set' : 'NOT SET - replace YOUR_API_KEY in script src'));
  </script>
</body>
</html>
