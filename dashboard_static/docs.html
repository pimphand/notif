<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NotifMoo JS Client Docs</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 min-h-screen">
  <div class="max-w-4xl mx-auto py-10 px-4">
    <header class="mb-10">
      <h1 class="text-3xl font-bold text-slate-900 mb-2">NotifMoo JavaScript Client</h1>
      <p class="text-slate-600">
        Dokumentasi cara menggunakan NotifMoo via CDN untuk menerima notifikasi real‑time dari Notif.
      </p>
      <a href="index.html" class="inline-flex items-center text-sm text-indigo-600 hover:text-indigo-800 mt-3">
        ← Kembali ke Dashboard
      </a>
    </header>

    <section class="mb-10">
      <h2 class="text-xl font-semibold text-slate-900 mb-3">1. Menambahkan CDN</h2>
      <p class="text-slate-700 mb-3">
        Tambahkan skrip berikut di bagian <code>&lt;head&gt;</code> atau sebelum <code>&lt;/body&gt;</code> pada aplikasi Anda.
        Ganti <code>YOUR_API_KEY</code> dengan API key domain yang Anda buat di Dashboard.
      </p>
      <div class="bg-slate-900 text-slate-100 rounded-lg p-4 text-sm font-mono overflow-x-auto mb-3">
        &lt;script src="https://cdn.jsdelivr.net/gh/pimphand/notifmoo_@main/setup.js?apikey=YOUR_API_KEY"&gt;&lt;/script&gt;
      </div>
      <p class="text-slate-700">
        Anda juga bisa menambahkan parameter opsional <code>host</code> bila ingin mengarah ke endpoint WebSocket lain:
      </p>
      <div class="bg-slate-900 text-slate-100 rounded-lg p-4 text-sm font-mono overflow-x-auto mt-3">
        &lt;script src="https://cdn.jsdelivr.net/gh/pimphand/notifmoo_@main/setup.js?apikey=YOUR_API_KEY&amp;host=wss://notification.officialconnect.id"&gt;&lt;/script&gt;
      </div>
      <p class="text-xs text-slate-500 mt-2">
        Catatan: Origin (domain) halaman Anda harus sama dengan domain yang terdaftar di Dashboard agar API key valid.
      </p>
    </section>

    <section class="mb-10">
      <h2 class="text-xl font-semibold text-slate-900 mb-3">2. Objek Global <code>NotifMoo</code></h2>
      <p class="text-slate-700 mb-3">
        Setelah skrip CDN dimuat, library akan otomatis mencoba konek ke WebSocket dan menambahkan objek global <code>NotifMoo</code>.
      </p>
      <ul class="list-disc list-inside text-slate-700 space-y-1 mb-3">
        <li><code>NotifMoo.connect()</code>: memulai koneksi (biasanya otomatis dipanggil).</li>
        <li><code>NotifMoo.subscribe(channel, options)</code>: subscribe ke channel tertentu.</li>
        <li><code>NotifMoo.unsubscribe(channel)</code>: unsubscribe dari channel.</li>
        <li><code>NotifMoo.bind(event, callback)</code>: listen event global tertentu.</li>
        <li><code>NotifMoo.onConnect(callback)</code>: dipanggil ketika koneksi berhasil.</li>
        <li><code>NotifMoo.onError(callback)</code>: menangkap error koneksi.</li>
      </ul>
      <p class="text-slate-700">
        Library ini mirip dengan client Pusher: setiap pesan memiliki <code>event</code>, <code>channel</code>, dan <code>data</code>.
      </p>
    </section>

    <section class="mb-10">
      <h2 class="text-xl font-semibold text-slate-900 mb-3">3. Contoh Sederhana</h2>
      <p class="text-slate-700 mb-3">
        Contoh halaman HTML lengkap yang subscribe ke channel publik dan menampilkan pesan yang diterima.
      </p>
      <div class="bg-slate-900 text-slate-100 rounded-lg p-4 text-xs font-mono overflow-x-auto">
        &lt;!DOCTYPE html&gt;<br>
        &lt;html lang="en"&gt;<br>
        &lt;head&gt;<br>
        &nbsp;&nbsp;&lt;meta charset="UTF-8"&gt;<br>
        &nbsp;&nbsp;&lt;title&gt;NotifMoo Demo&lt;/title&gt;<br>
        &nbsp;&nbsp;&lt;script src="https://cdn.jsdelivr.net/gh/pimphand/notifmoo_@main/setup.js?apikey=YOUR_API_KEY"&gt;&lt;/script&gt;<br>
        &lt;/head&gt;<br>
        &lt;body&gt;<br>
        &nbsp;&nbsp;&lt;h1&gt;NotifMoo Demo&lt;/h1&gt;<br>
        &nbsp;&nbsp;&lt;pre id="log"&gt;&lt;/pre&gt;<br>
        <br>
        &nbsp;&nbsp;&lt;script&gt;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;function log(line) {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document.getElementById('log').textContent += line + '\n';<br>
        &nbsp;&nbsp;&nbsp;&nbsp;}<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;NotifMoo.onConnect(function () {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log('Connected! socket_id=' + NotifMoo.socketId);<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Subscribe ke channel, misalnya "public-demo"<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NotifMoo.subscribe('public-demo', {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onMessage: function (msg) {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log('[channel=' + msg.channel + '] event=' + msg.event + ' data=' + JSON.stringify(msg.data));<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>
        &nbsp;&nbsp;&nbsp;&nbsp;});<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;NotifMoo.onError(function (err) {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log('ERROR: ' + err.message + (err.code ? ' (code=' + err.code + ')' : ''));<br>
        &nbsp;&nbsp;&nbsp;&nbsp;});<br>
        &nbsp;&nbsp;&lt;/script&gt;<br>
        &lt;/body&gt;<br>
        &lt;/html&gt;<br>
      </div>
    </section>

    <section class="mb-10">
      <h2 class="text-xl font-semibold text-slate-900 mb-3">4. Contoh dengan Channel Per‑User</h2>
      <p class="text-slate-700 mb-3">
        Misalkan backend Anda mengirim notifikasi ke channel seperti <code>user.123</code> (123 = ID user).
        Berikut contoh cara subscribe dari frontend:
      </p>
      <div class="bg-slate-900 text-slate-100 rounded-lg p-4 text-sm font-mono overflow-x-auto">
        // Misal Anda sudah tahu userId dari session / blade / JS<br>
        const userId = 123;<br>
        const channelName = `user.${userId}`;<br>
        <br>
        NotifMoo.onConnect(function () {<br>
        &nbsp;&nbsp;NotifMoo.subscribe(channelName, {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;onMessage: function (msg) {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log('New notification for user', msg);<br>
        &nbsp;&nbsp;&nbsp;&nbsp;}<br>
        &nbsp;&nbsp;});<br>
        });<br>
      </div>
    </section>

    <section class="mb-10">
      <h2 class="text-xl font-semibold text-slate-900 mb-3">5. Event Global</h2>
      <p class="text-slate-700 mb-3">
        Selain <code>onMessage</code> per‑channel, Anda bisa menangkap semua event yang masuk dengan event global:
      </p>
      <div class="bg-slate-900 text-slate-100 rounded-lg p-4 text-sm font-mono overflow-x-auto">
        // Semua event (debugging)<br>
        NotifMoo.bind('*', function (payload) {<br>
        &nbsp;&nbsp;console.log('EVENT', payload.event, 'CHANNEL', payload.channel, 'DATA', payload.data);<br>
        });<br>
        <br>
        // Event khusus, misalnya "order.updated"<br>
        NotifMoo.bind('order.updated', function (payload) {<br>
        &nbsp;&nbsp;console.log('Order updated:', payload.data);<br>
        });<br>
      </div>
    </section>

    <section class="mb-10">
      <h2 class="text-xl font-semibold text-slate-900 mb-3">6. Contoh Aplikasi Chat Sederhana</h2>
      <p class="text-slate-700 mb-3">
        Contoh berikut menunjukkan UI chat sederhana yang subscribe ke channel <code>chat.room1</code> dan menampilkan pesan
        yang dikirim lewat backend (misalnya melalui endpoint broadcast Notif). Di sisi frontend kita hanya mendengarkan
        event dan menambahkannya ke tampilan.
      </p>
      <div class="bg-slate-900 text-slate-100 rounded-lg p-4 text-xs font-mono overflow-x-auto mb-3">
        &lt;!DOCTYPE html&gt;<br>
        &lt;html lang="en"&gt;<br>
        &lt;head&gt;<br>
        &nbsp;&nbsp;&lt;meta charset="UTF-8"&gt;<br>
        &nbsp;&nbsp;&lt;title&gt;NotifMoo Chat Room&lt;/title&gt;<br>
        &nbsp;&nbsp;&lt;style&gt;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;body { font-family: system-ui, sans-serif; }<br>
        &nbsp;&nbsp;&nbsp;&nbsp;#messages { border: 1px solid #e2e8f0; padding: 8px; height: 240px; overflow-y: auto; }<br>
        &nbsp;&nbsp;&nbsp;&nbsp;.msg { margin-bottom: 4px; }<br>
        &nbsp;&nbsp;&nbsp;&nbsp;.msg span { font-size: 12px; color: #64748b; }<br>
        &nbsp;&nbsp;&lt;/style&gt;<br>
        &nbsp;&nbsp;&lt;script src="https://cdn.jsdelivr.net/gh/pimphand/notifmoo_@main/setup.js?apikey=YOUR_API_KEY"&gt;&lt;/script&gt;<br>
        &lt;/head&gt;<br>
        &lt;body&gt;<br>
        &nbsp;&nbsp;&lt;h1&gt;Chat Room (chat.room1)&lt;/h1&gt;<br>
        &nbsp;&nbsp;&lt;div id="messages"&gt;&lt;/div&gt;<br>
        &nbsp;&nbsp;&lt;div style="margin-top: 8px;"&gt;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&lt;input id="name" placeholder="Nama Anda" style="width: 140px;" /&gt;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&lt;input id="text" placeholder="Tulis pesan..." style="width: 220px;" /&gt;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&lt;button id="send"&gt;Kirim (via backend)&lt;/button&gt;<br>
        &nbsp;&nbsp;&lt;/div&gt;<br>
        <br>
        &nbsp;&nbsp;&lt;script&gt;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;const room = 'chat.room1';<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;function addMessage(payload) {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const box = document.getElementById('messages');<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const div = document.createElement('div');<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;div.className = 'msg';<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const data = payload.data || {};<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const name = data.name || 'anon';<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const text = data.text || '';<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;div.innerHTML = '&lt;span&gt;' + name + '&lt;/span&gt;: ' + text;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;box.appendChild(div);<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;box.scrollTop = box.scrollHeight;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;}<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;// Dengarkan pesan chat dari backend<br>
        &nbsp;&nbsp;&nbsp;&nbsp;NotifMoo.onConnect(function () {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NotifMoo.subscribe(room, {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onMessage: function (msg) {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addMessage(msg);<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>
        &nbsp;&nbsp;&nbsp;&nbsp;});<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;// Contoh tombol Kirim: biasanya akan memanggil REST API/backend<br>
        &nbsp;&nbsp;&nbsp;&nbsp;// yang kemudian melakukan broadcast ke channel "chat.room1" melalui Notif.<br>
        &nbsp;&nbsp;&nbsp;&nbsp;document.getElementById('send').addEventListener('click', async function () {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const name = document.getElementById('name').value || 'anon';<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const text = document.getElementById('text').value;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!text) return;<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document.getElementById('text').value = '';<br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Ganti URL di bawah dengan endpoint backend Anda sendiri<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;await fetch('/api/chat/send', {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method: 'POST',<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers: { 'Content-Type': 'application/json' },<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body: JSON.stringify({ channel: room, name, text })<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} catch (e) {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.error('Gagal kirim pesan', e);<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
        &nbsp;&nbsp;&nbsp;&nbsp;});<br>
        &nbsp;&nbsp;&lt;/script&gt;<br>
        &lt;/body&gt;<br>
        &lt;/html&gt;<br>
      </div>
      <p class="text-xs text-slate-500">
        Penting: URL <code>/api/chat/send</code> di atas hanyalah contoh. Sesuaikan dengan endpoint backend Anda yang akan
        mem-broadcast pesan ke channel <code>chat.room1</code> melalui Notif.
      </p>
    </section>

    <section class="mb-10">
      <h2 class="text-xl font-semibold text-slate-900 mb-3">7. Demo Cepat: Buka 2 Jendela Chat</h2>
      <p class="text-slate-700 mb-3">
        Untuk mencoba dua client chat sekaligus, klik tombol di bawah ini. Halaman akan membuka dua jendela baru:
        masing‑masing menggunakan nama berbeda (<code>Chat 1</code> dan <code>Chat 2</code>) pada channel yang sama.
        Pastikan Anda sudah mengisi API key di file <code>chat-demo.html</code>.
      </p>
      <button id="open-two-chat" class="bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium px-4 py-2 rounded">
        Buka 2 jendela chat demo
      </button>
      <p class="text-xs text-slate-500 mt-2">
        File yang dipakai: <code>chat-demo.html</code>. Parameter query <code>?name=Chat+1</code> dan <code>?name=Chat+2</code>
        hanya mengisi nama default di input.
      </p>
    </section>

    <footer class="border-t border-slate-200 pt-4 mt-8 text-xs text-slate-500">
      NotifMoo JS client — gunakan API key dari halaman Domains di Dashboard.
    </footer>
  </div>
  <script>
    (function () {
      var btn = document.getElementById('open-two-chat');
      if (!btn) return;
      btn.addEventListener('click', function () {
        window.open('chat-demo.html?name=Chat+1', 'notif-chat-1', 'width=520,height=700');
        window.open('chat-demo.html?name=Chat+2', 'notif-chat-2', 'width=520,height=700,left=540');
      });
    })();
  </script>
</body>
</html>
